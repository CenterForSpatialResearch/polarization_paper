<!DOCTYPE html>
<html>
<head>
     <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="../favicon.ico" rel="shortcut icon" type="image/x-icon" />
    <title>concordance</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script type="text/javascript" src="../lib/d3.v5.min.js"></script>
<!--
    <script type="text/javascript" src="downloadSVG.js"></script>
-->
  <link rel="stylesheet" type="text/css" href="concordence.css">
  
    
    <style>
        .t{
            display:inline-block;
            border:1px solid black;
            overflow:auto;
        }
     
        #b{
            width:50%;
            text-align:right;
        }
        #c{
          margin-left:50%;  
        }
        #a{
            width:50%;
          margin-left:50%;  
        }
        
        
    </style>
</head>
<body>
   <div id="info"></div>
   <div id="control">control</div>
  <div id="test">
      <div class="row">
          <div id="b" class="t">  among friends have demonstrated their importance to product marketing</div>
          <div id="c" class="t">homophily</div>
          <div id="a" class="t">homophily among friends have demonstrated their importance to product marketing</div>
      </div>

       <div class="row" id="sec">
           <div id="b" class="t">  among friends have demonortance to product marketing</div>
           <div id="c" class="t">homophily</div>
           <div id="a" class="t">homophily among friends have demonstrated their importance to product marketing</div>
       </div>
     </div>
  
    <div id="chart1">
    </div>
   



<script>
    
    d3.select("#a").style("width","900px")
    
    
    var splitBy = "homophily"
    var field = "computer_science"//"behavioral_sciences" "psychology"
    var maxFontSize = 14
    var minFontSize = 14
    var maxAtLine = 0
    var lengthLimit = 1000

    
    document.title = field.replace("_"," ")
    
    Promise.all([d3.csv("data/citations by field - "+field+".csv")])
    .then(function(data){
        var formatted = formatData(data[0])
        var formateByMaxAtLine = orderByMaxAtLine(formatted)
        drawText(formateByMaxAtLine)
        //drawSvgText(formatted)
    })
    
    
function drawSvgText(data){
    console.log(data.length)
    var fontWidth = 2
    var fontHeight = 15
    var padding = 30
    var h = 20000
    var w = window.innerWidth
    var svg = d3.select("#chart1").append("svg").attr("height",h).attr("width",w)
    
    var topMarginIndex = 0
    for(var i in data){
        var absList = data[i].split(splitBy)
        if(absList.length>1){
            svg.append("text").text(absList[0]).attr("x",0).attr("y",i*fontHeight).attr("text-anchor","end")
                .attr("transform","translate("+w/2+","+padding+")")
        
            svg.append("text").text(splitBy).attr("x",0).attr("y",i*fontHeight)
                .attr("transform","translate("+(w/2+fontWidth)+","+padding+")").attr("text-anchor","start")

            var ending = absList[1]+"."
            if(ending[0]!="\'" && ending[0]!=","&& ending[0]!="."&& ending[0]!="-"&& ending[0]!=")"&& ending[0]!="\""){
                ending = "\u00A0"+ending
            }

            svg.append("text").text(ending).attr("x",0).attr("y",i*fontHeight).attr("text-anchor","start")
                .attr("transform","translate("+(w/2+(splitBy.length+15)*fontWidth)+","+padding+")")
        }
    }
    downloadSVG()
}
function formatData(data){
    var split = []
    for(var i in data){
        if(data[i].Abs!=undefined){
            var abs = data[i].Abs
            var absList = abs.split(". ")
            for(var j in absList){
                if(absList[j].split(splitBy).length>1){
                    split.push(absList[j])
                }
            }
        }
    }
    split.sort(function(a,b){return a.length-b.length})
    return split
}
function orderByMaxAtLine(list){
  //  list.sort(function(a,b){return b.length-a.length})
    var newList = []
    var maxAtLineCounter = maxAtLine
    
    for(var i in list){
            if(i%(Math.round(list.length/maxAtLine))!=0){
                newList.push(list[i])
            }else{
                newList.unshift(list[i])
            }
       
    }
    return newList
}

function drawText(data){
    d3.select("#info").html(field+":"+data.length+" cases")
    var splitBy = "homophily"
    var topMarginIndex = 0
    var topMargin = 0
    var fontSizeScaleTop = d3.scaleLinear().domain([0,maxAtLine]).range([maxFontSize,minFontSize])
    var fontSizeScaleBottom = d3.scaleLinear().domain([0,data.length-maxAtLine]).range([maxFontSize,minFontSize])
    
   // var fontSizeScaleVertical = d3.scaleLinear().domain([maxFontSize,minFontSize]).range([maxFontSize,minFontSize])
    
    for(var i in data){
            var absList = data[i].split(splitBy)
            
            if(absList.length>1 && absList[0].length<lengthLimit && absList[1].length<lengthLimit){
                topMarginIndex+=1
                
                if(i<=maxAtLine){
                    topMargin += fontSizeScaleTop(Math.abs(i-maxAtLine))
                }else{
                    topMargin += fontSizeScaleBottom(Math.abs(i-maxAtLine))
                }
                
                d3.select("#chart1").append("div").attr("id","index_"+i).attr("class","row row_"+i)
                
                d3.select("#index_"+i).append("div").html(absList[0]).attr("class","before before_"+i)                
              //  .style("top",topMargin+"px")

                d3.select("#index_"+i).append("div").html(splitBy).attr("class","center center_"+i)
             //   .style("top",topMargin+"px")
                
                
                var ending = absList[1]
                
                if(absList[1][absList[1].length-1]!="."){
                    ending =absList[1]+"."
                }
                if(ending[0]!="\'" && ending[0]!=","&& ending[0]!="."&& ending[0]!="-"&& ending[0]!=")"&& ending[0]!="\""){
                    ending = "&nbsp"+ending
                }
            
                d3.select("#index_"+i).append("div")
                .html(ending)
                .attr("class","after after_"+i)
              //  .style("top",topMargin+"px")
                
                //d3.selectAll(".row_"+i)
                //.style("font-size",function(){
                //    if(i<=maxAtLine){
                //        return fontSizeScaleTop(Math.abs(i-maxAtLine))+"px"
                //    }else{
                //        return fontSizeScaleBottom(Math.abs(i-maxAtLine))+"px"
                //    }
                //})
                //var centerWidth = parseFloat(d3.select(".center_"+i).style("width").replace("px",""))*1.1
                //
                //d3.select(".before_"+i)
                //.style("right",function(){
                //    var previousML = parseFloat(d3.select(".before_"+i).style("right").replace("px",""))
                //    return window.innerWidth/2+centerWidth/2-8+"px"
                //})
                //
                //d3.select(".center_"+i)
                //.style("margin-left",function(){
                //    var previousML = parseFloat(d3.select(".center_"+i).style("margin-left").replace("px",""))                    
                //        return window.innerWidth/2-centerWidth/2-8+"px"
                //    
                //}).style("text-align","center")
                //
                //d3.select(".after_"+i)
                //.style("left",centerWidth/2+"px")
                //
                //var opacityScaleTop = d3.scaleLinear().domain([0,maxAtLine]).range([0.5,1])
                //var opacityScaleBottom = d3.scaleLinear().domain([maxAtLine,data.length-maxAtLine]).range([1,0.5])
                //
                //d3.select(".row_"+i)
                //.style("opacity",function(){
                //    if(i<maxAtLine){
                //        return opacityScaleTop(i)
                //    }else{
                //        return opacityScaleBottom(i)
                //    }
                //})
                
                
                //break
            }
    }
}
</script>
</body>
</html>