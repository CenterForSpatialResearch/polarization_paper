<!DOCTYPE html>
<html>
<head>
     <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="../favicon.ico" rel="shortcut icon" type="image/x-icon" />
    <title>concordance</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script type="text/javascript" src="../lib/d3.v5.min.js"></script>
<!--
    <script type="text/javascript" src="downloadSVG.js"></script>
-->
  <link rel="stylesheet" type="text/css" href="concordence.css">
  
    
    <style>
       
        
    </style>
</head>
<body>
   <div id="info"></div>
   <div id="control">control</div>
  
    <div id="chart1">
    </div>
   



<script>
    
    d3.select("#a").style("width","900px")
    
    
    var splitBy = "homophily"
    var field = "computer_science"//"behavioral_sciences" "psychology"
    var maxFontSize = 14
    var minFontSize = 14
    var maxAtLine = 0
    var lengthLimit = 1000

    
    document.title = field.replace("_"," ")
    
    Promise.all([d3.csv("data/citations by field - "+field+".csv")])
    .then(function(data){
        var formatted = formatData(data[0])
        var formateByMaxAtLine = orderByMaxAtLine(formatted)
        drawText(formateByMaxAtLine)
        //drawSvgText(formatted)
    })
    
    
function drawSvgText(data){
    console.log(data.length)
    var fontWidth = 2
    var fontHeight = 15
    var padding = 30
    var h = 20000
    var w = window.innerWidth
    var svg = d3.select("#chart1").append("svg").attr("height",h).attr("width",w)
    
    var topMarginIndex = 0
    for(var i in data){
        var absList = data[i].split(splitBy)
        if(absList.length>1){
            svg.append("text").text(absList[0]).attr("x",0).attr("y",i*fontHeight).attr("text-anchor","end")
                .attr("transform","translate("+w/2+","+padding+")")
        
            svg.append("text").text(splitBy).attr("x",0).attr("y",i*fontHeight)
                .attr("transform","translate("+(w/2+fontWidth)+","+padding+")").attr("text-anchor","start")

            var ending = absList[1]+"."
            if(ending[0]!="\'" && ending[0]!=","&& ending[0]!="."&& ending[0]!="-"&& ending[0]!=")"&& ending[0]!="\""){
                ending = "\u00A0"+ending
            }

            svg.append("text").text(ending).attr("x",0).attr("y",i*fontHeight).attr("text-anchor","start")
                .attr("transform","translate("+(w/2+(splitBy.length+15)*fontWidth)+","+padding+")")
        }
    }
    downloadSVG()
}
function formatData(data){
    var split = []
    for(var i in data){
        if(data[i].Abs!=undefined){
            var abs = data[i].Abs
            var absList = abs.split(". ")
            for(var j in absList){
                if(absList[j].split(splitBy).length>1){
                    split.push(absList[j])
                }
            }
        }
    }
    split.sort(function(a,b){return a.length-b.length})
    return split
}
function orderByMaxAtLine(list){
  //  list.sort(function(a,b){return b.length-a.length})
    var newList = []
    var maxAtLineCounter = maxAtLine
    
    for(var i in list){
            if(i%(Math.round(list.length/maxAtLine))!=0){
                newList.push(list[i])
            }else{
                newList.unshift(list[i])
            }
       
    }
    return newList
}

function drawText(data){
    d3.select("#info").html(field+":"+data.length+" cases")
    var splitBy = "homophily"
    var topMarginIndex = 0
    var topMargin = 0
    var fontSizeScaleTop = d3.scaleLinear().domain([0,maxAtLine]).range([maxFontSize,minFontSize])
    var fontSizeScaleBottom = d3.scaleLinear().domain([0,data.length-maxAtLine]).range([maxFontSize,minFontSize])
    
   // var fontSizeScaleVertical = d3.scaleLinear().domain([maxFontSize,minFontSize]).range([maxFontSize,minFontSize])
    
    for(var i in data){
            var absList = data[i].split(splitBy)
            
            if(absList.length>1 && absList[0].length<lengthLimit && absList[1].length<lengthLimit){
                topMarginIndex+=1
                
                if(i<=maxAtLine){
                    topMargin += fontSizeScaleTop(Math.abs(i-maxAtLine))
                }else{
                    topMargin += fontSizeScaleBottom(Math.abs(i-maxAtLine))
                }
                
                var row = d3.select("#chart1").append("div").attr("id","index_"+i).attr("class","row")
                
                
                if(absList[0]==""){
                    var ending = "<strong>&nbsp;Homophily</strong>"+absList[1]
                }else{
                    var ending = "<strong>&nbsp;homophily</strong>"+absList[1]
                }
                
                
                if(absList[1][absList[1].length-1]!="."){
                    ending =ending+"."
                }
                //if(ending[0]!="\'" && ending[0]!=","&& ending[0]!="."&& ending[0]!="-"&& ending[0]!=")"&& ending[0]!="\""){
                //    ending = "&nbsp"+ending
                //}
                
                
                row.append("div")
                .html(absList[0])
                .attr("class","before before_"+i)//  
            //    row.append("div").html("b").attr("class","center center_"+i)//.html(splitBy)
                
                row.append("div")//.html("c")
                .html(ending)
                .attr("class","after after_"+i)
             
            }
    }
}
</script>
</body>
</html>